# í•´í”¼ë‹ˆì–¸ ì•„ì¹´ë°ë¯¸ (Happynian Academy)

ëª¨ë°”ì¼ ìš°ì„  ë°˜ì‘í˜• ì›¹ì•± - ê°•ì˜ ì¼ì • ê´€ë¦¬, ì¶œì„/ê³¼ì œ ì²´í¬, ì‹œì²­ê° ê°•ì˜ì‹¤

## ğŸ“‹ ëª©ì°¨
- [ì•„í‚¤í…ì²˜ ê°œìš”](#ì•„í‚¤í…ì²˜-ê°œìš”)
- [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
- [í´ë” êµ¬ì¡°](#í´ë”-êµ¬ì¡°)
- [ì„¤ì¹˜ ë° ì‹¤í–‰](#ì„¤ì¹˜-ë°-ì‹¤í–‰)
- [í™˜ê²½ ë³€ìˆ˜](#í™˜ê²½-ë³€ìˆ˜)
- [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •](#ë°ì´í„°ë² ì´ìŠ¤-ì„¤ì •)
- [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)
- [n8n ì—°ë™](#n8n-ì—°ë™)
- [êµ¬ê¸€ì‹œíŠ¸ ì»¬ëŸ¼ ê·œê²©](#êµ¬ê¸€ì‹œíŠ¸-ì»¬ëŸ¼-ê·œê²©)

---

## ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì‚¬ìš©ì (WebView/ë¸Œë¼ìš°ì €)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Next.js 14 App Router                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   /home     â”‚  â”‚  /calendar  â”‚  â”‚ /classroom  â”‚  ...         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚           API Route Handlers                     â”‚            â”‚
â”‚  â”‚  /api/webhooks/*  (n8nìš©)  /api/admin/*         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
            â–¼                      â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase Auth   â”‚    â”‚          Supabase PostgreSQL           â”‚
â”‚   (ì¸ì¦/ì„¸ì…˜)      â”‚    â”‚   RLS ì •ì±…ìœ¼ë¡œ ë°ì´í„° ì ‘ê·¼ ì œì–´         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â–²
                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          n8n / Make                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ êµ¬ê¸€ì‹œíŠ¸ ë™ê¸°í™”  â”‚  â”‚  ì•Œë¦¼í†¡ ë°œì†¡    â”‚  â”‚  ë‚©ë¶€ê¸°ë¡ ë™ê¸°í™” â”‚  â”‚
â”‚  â”‚ (5ë¶„/1ì‹œê°„ ì£¼ê¸°) â”‚  â”‚  (D-7, D-1)     â”‚  â”‚  (1ì¼ 1íšŒ)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ íë¦„

1. **íšŒì›ê°€ì…/ë¡œê·¸ì¸**: Supabase Auth â†’ profiles í…Œì´ë¸” ìƒì„±
2. **ìŠ¹ì¸ ëŒ€ê¸°**: status='pending' ìƒíƒœë©´ /pending í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
3. **ê°•ì˜ ì¼ì •**: êµ¬ê¸€ì‹œíŠ¸ â†’ n8n â†’ /api/webhooks/sync-sessions â†’ DB
4. **ì¦ê²¨ì°¾ê¸°/ì•Œë¦¼**: ì‚¬ìš©ìê°€ ì§€ì—­+ë ˆë²¨ ì €ì¥, n8nì´ ì•Œë¦¼í†¡ ë°œì†¡
5. **ì¶œì„/ê³¼ì œ**: ê´€ë¦¬ìê°€ ì²´í¬ â†’ eligibility_status ìë™ ê³„ì‚°
6. **ì˜ìƒ ì‹œì²­**: ê¶Œí•œì— ë”°ë¥¸ ì ‘ê·¼ ì œì–´ + ì§„í–‰ë¥  ì €ì¥

---

## ê¸°ìˆ  ìŠ¤íƒ

| ì˜ì—­ | ê¸°ìˆ  |
|------|------|
| í”„ë ˆì„ì›Œí¬ | Next.js 14+ (App Router) |
| ì–¸ì–´ | TypeScript |
| ìŠ¤íƒ€ì¼ë§ | TailwindCSS |
| ë°±ì—”ë“œ/DB | Supabase (Auth + PostgreSQL + RLS) |
| ë°°í¬ | Vercel |
| ìë™í™” | n8n / Make |
| ìƒíƒœê´€ë¦¬ | React Context + Server Components |

---

## í´ë” êµ¬ì¡°

```
happynian-academy/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/               # ì¸ì¦ ê´€ë ¨ (ë¡œê·¸ì¸, íšŒì›ê°€ì…)
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ signup/
â”‚   â”‚   â”œâ”€â”€ (main)/               # ë©”ì¸ ì•± (ì¸ì¦ í•„ìš”)
â”‚   â”‚   â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”‚   â”œâ”€â”€ calendar/
â”‚   â”‚   â”‚   â”œâ”€â”€ favorites/
â”‚   â”‚   â”‚   â”œâ”€â”€ classroom/
â”‚   â”‚   â”‚   â”œâ”€â”€ attendance/
â”‚   â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚   â”œâ”€â”€ admin/                # ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â”œâ”€â”€ pending/              # ìŠ¹ì¸ ëŒ€ê¸° í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ api/                  # API ë¼ìš°íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ webhooks/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sync-sessions/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sync-payments/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ notify-log/
â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”‚       â””â”€â”€ approve-user/
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ components/               # ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ ui/                   # ê¸°ë³¸ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ layout/               # ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ calendar/             # ìº˜ë¦°ë” ê´€ë ¨
â”‚   â”‚   â”œâ”€â”€ session/              # ê°•ì˜ ì„¸ì…˜ ê´€ë ¨
â”‚   â”‚   â””â”€â”€ auth/                 # ì¸ì¦ ê´€ë ¨
â”‚   â”œâ”€â”€ lib/                      # ìœ í‹¸ë¦¬í‹°/ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts
â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ constants.ts          # ìê²© ê¸°ì¤€ ë“± ì„¤ì •
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”œâ”€â”€ hooks/                    # ì»¤ìŠ¤í…€ í›…
â”‚   â”œâ”€â”€ types/                    # TypeScript íƒ€ì…
â”‚   â””â”€â”€ contexts/                 # React Context
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/               # DB ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚   â””â”€â”€ seed.sql                  # ë”ë¯¸ ë°ì´í„°
â”œâ”€â”€ public/
â”œâ”€â”€ .env.local.example
â”œâ”€â”€ package.json
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

---

## ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. ì˜ì¡´ì„± ì„¤ì¹˜
```bash
npm install
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
cp .env.local.example .env.local
# .env.local íŒŒì¼ í¸ì§‘
```

### 3. Supabase ì„¤ì •
1. https://supabase.com ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
2. SQL Editorì—ì„œ `supabase/migrations/001_initial.sql` ì‹¤í–‰
3. í”„ë¡œì íŠ¸ URLê³¼ anon keyë¥¼ .env.localì— ì„¤ì •

### 4. ê°œë°œ ì„œë²„ ì‹¤í–‰
```bash
npm run dev
```

### 5. (ì„ íƒ) ë”ë¯¸ ë°ì´í„° ì‚½ì…
```bash
# Supabase SQL Editorì—ì„œ supabase/seed.sql ì‹¤í–‰
```

---

## í™˜ê²½ ë³€ìˆ˜

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Webhook ë³´ì•ˆ
WEBHOOK_SECRET=your_webhook_secret_key

# ì•± ì„¤ì •
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### Webhook (n8nìš©)
ëª¨ë“  ì›¹í›…ì€ HMAC-SHA256 ì„œëª… ê²€ì¦ í•„ìš”

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | /api/webhooks/sync-sessions | ê°•ì˜ ì„¸ì…˜ ë™ê¸°í™” |
| POST | /api/webhooks/sync-payments | ë‚©ë¶€ ê¸°ë¡ ë™ê¸°í™” |
| POST | /api/webhooks/notify-log | ì•Œë¦¼ ë°œì†¡ ë¡œê·¸ |

### ê´€ë¦¬ììš©
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | /api/admin/approve-user | íšŒì› ìŠ¹ì¸/ê±°ì ˆ/ì •ì§€ |

---

## n8n ì—°ë™

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê°•ì˜ ì¼ì • ë™ê¸°í™”
- **íŠ¸ë¦¬ê±°**: Schedule (5ë¶„ ë˜ëŠ” 1ì‹œê°„ë§ˆë‹¤)
- **ë…¸ë“œ êµ¬ì„±**:
  1. Schedule Trigger
  2. Google Sheets â†’ Read ì „ì²´ í–‰
  3. Code â†’ payload ë³€í™˜
  4. HTTP Request â†’ POST /api/webhooks/sync-sessions

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì•Œë¦¼ ë°œì†¡
- **íŠ¸ë¦¬ê±°**: Schedule (ë§¤ì¼ ì˜¤ì „ 9ì‹œ)
- **ë…¸ë“œ êµ¬ì„±**:
  1. Schedule Trigger
  2. Supabase â†’ favorites ì¡°íšŒ (notify_enabled=true)
  3. Supabase â†’ sessions ì¡°íšŒ (D-7, D-1 ëŒ€ìƒ)
  4. IF â†’ ì•Œë¦¼ ëŒ€ìƒ ìˆìœ¼ë©´
  5. KakaoTalk ì•Œë¦¼í†¡ API í˜¸ì¶œ
  6. HTTP Request â†’ POST /api/webhooks/notify-log

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë‚©ë¶€ ê¸°ë¡ ë™ê¸°í™”
- **íŠ¸ë¦¬ê±°**: Schedule (ë§¤ì¼ ìì •)
- **ë…¸ë“œ êµ¬ì„±**:
  1. Schedule Trigger
  2. Google Sheets â†’ ë‚©ë¶€ ì‹œíŠ¸ Read
  3. Code â†’ payload ë³€í™˜
  4. HTTP Request â†’ POST /api/webhooks/sync-payments

---

## êµ¬ê¸€ì‹œíŠ¸ ì»¬ëŸ¼ ê·œê²©

### ê°•ì˜ ì¼ì • ì‹œíŠ¸ (Sessions)
| ì»¬ëŸ¼ëª… | íƒ€ì… | ì˜ˆì‹œ | ì„¤ëª… |
|--------|------|------|------|
| course_title | text | "6ê°œì›” ê¸°ë³¸ê³¼ì •" | ê³¼ì •ëª… |
| duration_type | text | "6m" | 6m/12m |
| region | text | "ì„œìš¸" | ì§€ì—­ |
| level | text | "ì´ˆê¸‰" | ë ˆë²¨ |
| session_no | number | 3 | íšŒì°¨ ë²ˆí˜¸ |
| title | text | "ìê¸°ì†Œê°œì™€ ê´€ê³„ë§ºê¸°" | ê°•ì˜ëª… |
| instructor | text | "ê¹€í•´í”¼ ê°•ì‚¬" | ê°•ì‚¬ëª… |
| start_at | datetime | "2025-01-20 14:00:00" | ì‹œì‘ ì¼ì‹œ (KST) |
| end_at | datetime | "2025-01-20 17:00:00" | ì¢…ë£Œ ì¼ì‹œ (KST) |
| materials_json | text | '["í•„ê¸°ë„êµ¬","ë…¸íŠ¸"]' | ì¤€ë¹„ë¬¼ JSON ë°°ì—´ |
| notes | text | "í¸í•œ ë³µì¥ìœ¼ë¡œ" | ë¹„ê³  |
| visibility | text | "public" | public/group |

### ë‚©ë¶€ ê¸°ë¡ ì‹œíŠ¸ (Payments)
| ì»¬ëŸ¼ëª… | íƒ€ì… | ì˜ˆì‹œ | ì„¤ëª… |
|--------|------|------|------|
| user_email | text | "user@email.com" | ì‚¬ìš©ì ì´ë©”ì¼ |
| month | text | "2025-01" | ë‚©ë¶€ ì›” |
| amount | number | 150000 | ê¸ˆì•¡ |
| paid | boolean | TRUE | ë‚©ë¶€ ì—¬ë¶€ |
| paid_at | datetime | "2025-01-15" | ë‚©ë¶€ì¼ |
| memo | text | "ê³„ì¢Œì´ì²´" | ë©”ëª¨ |

---

## ê¶Œí•œ ëª¨ë¸

### ì—­í•  (role)
- `admin`: ì „ì²´ ê´€ë¦¬ ê¶Œí•œ
- `student`: ì¼ë°˜ ìˆ˜ê°•ìƒ

### ìƒíƒœ (status)
- `pending`: ìŠ¹ì¸ ëŒ€ê¸°
- `approved`: ìŠ¹ì¸ë¨
- `rejected`: ê±°ì ˆë¨
- `suspended`: ì •ì§€ë¨

### ìë™ ìŠ¹ì¸ ê·œì¹™
- ì¶”ì²œì¸ì— "í•´í”¼ë‹ˆì–¸" í¬í•¨ ì‹œ ìë™ ìŠ¹ì¸ (ì„¤ì • ê°€ëŠ¥)
- `auto_approve_mode`: "always" | "conditional" | "never"

### ì˜ìƒ ê¶Œí•œ (visibility)
- `public`: ì „ì²´ ê³µê°œ
- `group`: íŠ¹ì • ì§€ì—­/ë ˆë²¨ë§Œ
- `user`: íŠ¹ì • ì‚¬ìš©ìë§Œ (allowed_user_ids)
